extends layout

block main
    h2.h5.mb-3 Creación de Pedidos
    
    //- Contenedor para mensajes globales (Éxito al pagar, etc.)
    #msgGlobal.alert.d-none.mb-3

    //- ACORDEÓN PRINCIPAL
    #acordeonPedido.accordion
        
        //- 1. CLIENTES
        .accordion-item
            h2.accordion-header#headerCliente
                button.accordion-button(type="button" data-bs-toggle="collapse" data-bs-target="#collapseCliente") 1. Selección de Cliente
            #collapseCliente.accordion-collapse.collapse.show(data-bs-parent="#acordeonPedido")
                .accordion-body
                    .input-group.has-validation
                        input#dniBusquedaPedido.form-control(type="text" placeholder="DNI del cliente...")
                        button#btnBuscarCliente.btn.btn-primary(type="button") Buscar Cliente
                        //- Feedback visual para error en DNI
                        #feedbackDni.invalid-feedback DNI no encontrado o inválido.

                    //- Alerta cuando el cliente está seleccionado
                    #infoClienteSeleccionado.alert.alert-info.d-none.mt-3.d-flex.justify-content-between.align-items-center
                        div
                            span Cliente seleccionado: 
                            strong#nombreClienteActivo 
                        button#btnDesmarcarCliente.btn.btn-sm.btn-outline-danger(type="button") Deseleccionar / Nuevo Pedido

        //- 2. LIBROS
        .accordion-item
            h2.accordion-header#headerLibros
                button#btnAcordeonLibros.accordion-button.collapsed(type="button" data-bs-toggle="collapse" data-bs-target="#collapseLibros" disabled) 2. Añadir Libros al Pedido
            #collapseLibros.accordion-collapse.collapse(data-bs-parent="#acordeonPedido")
                .accordion-body
                    .row.g-3
                        .col-md-6
                            label.form-label Buscar Libro
                            .input-group
                                input#isbnBusquedaPedido.form-control(type="text" placeholder="ISBN del libro...")
                                button#btnBuscarLibroPedido.btn.btn-secondary(type="button") Buscar
                            //- Información del libro encontrado
                            #infoLibroEncontrado.small.text-muted.mt-2 (Introduce ISBN para buscar)
                    
                        .col-md-3
                            label.form-label Unidades
                            input#unidadesPedido.form-control(type="number" value="1" min="1")
                        
                        .col-md-3.d-flex.align-items-end
                            button#btnAnadirLibro.btn.btn-success.w-100(type="button" disabled) Añadir al Carrito
                    
                    //- Mensaje de error al añadir (stock insuficiente, etc)
                    #msgErrorLibro.alert.alert-danger.mt-2.d-none

        //- 3. ENVÍO Y RESUMEN
        .accordion-item
            h2.accordion-header#headerEnvio
                button#btnAcordeonEnvio.accordion-button.collapsed(type="button" data-bs-toggle="collapse" data-bs-target="#collapseEnvio" disabled) 3. Envío y Resumen
            #collapseEnvio.accordion-collapse.collapse(data-bs-parent="#acordeonPedido")
                .accordion-body
                    .mb-3
                        label.form-label.fw-bold Tipo de Envío
                        select#selectEnvio.form-select
                            //- Se llena con JS
                        #msgErrorEnvio.small.text-danger.mt-1.d-none

                    h5.mt-4 Resumen del Pedido
                    #resumenPedido.table-responsive
                        table.table.table-hover.table-sm.align-middle
                            thead.table-light
                                tr
                                    th Libro
                                    th Cant.
                                    th Precio U.
                                    th Total
                            tbody#tbodyResumen
                                //- Se llena dinámicamente
                            tfoot
                                tr
                                    td.text-end(colspan="3") Subtotal:
                                    td
                                        span#resumenSubtotal.fw-bold 0.00
                                        |  €
                                tr
                                    td.text-end(colspan="3") IVA (21%):
                                    td
                                        span#resumenIva.fw-bold 0.00
                                        |  €
                                tr.table-primary
                                    td.text-end.h5(colspan="3") Total:
                                    td.h5
                                        span#resumenTotal.text-primary.fw-bold 0.00
                                        |  €

                    //- BOTONES DE ACCIÓN FINAL
                    .row.mt-4
                        .col-12.text-end
                            button#btnCancelarPedido.btn.btn-danger.me-2(type="button" disabled) Cancelar
                            button#btnPagarPedido.btn.btn-success(type="button" disabled) Pagar Pedido